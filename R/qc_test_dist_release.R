##' @title QC Distance Release test
##'
##' @description ...
##' 
##' @param data data formatted by either `remora::get_data` or `remora::get_data_arbitrary`
##' @param qc_results the `temporal_outcome` object, holding all QC test results, 
##' generated by `remora::qc`
##' @param distance_threshold ...
##' 
##' @details ...
##' 
##' @return adds Distance Release test outcomes to temporal_outcome object
##' 
##' @importFrom geosphere distGeo
##' 
##' @keywords internal
##' 
qc_test_dist_release <- function(data, 
                                 qc_results, 
                                 distance_threshold = 500) {
  
  if("transmitter_deployment_longitude" %in% colnames(data) &&
     "transmitter_deployment_latitude" %in% colnames(data)) {
    message("Necessary columns present.")
    dist_r <- distGeo(cbind(data$transmitter_deployment_longitude[rep(1, nrow(data))],
                            data$transmitter_deployment_latitude[rep(1, nrow(data))]),
                      cbind(data$longitude, data$latitude)) / 1000 ## return in km
    message("distGeo done.")
    qc_results[, "DistanceRelease_QC"] <- ifelse(dist_r > distance_threshold, 2, 1)
  } else {
    message("No transmitter lat/long in dataframe, skipping distance-from-release check.")
  }
  return(qc_results)
}