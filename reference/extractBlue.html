<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Extract and append Bluelink Reanalysis (BRAN) environmental data to detection data — extractBlue • remora</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Extract and append Bluelink Reanalysis (BRAN) environmental data to detection data — extractBlue"><meta property="og:description" content="Accesses and download environmental data from the Bluelink (CSIRO)
server and append variables to detection data based on date of detection"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">remora</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="">0.8-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/shinyReport_transmitters.html">shinyReport_transmitters</a>
    </li>
    <li>
      <a href="../articles/shinyReport_receivers.html">shinyReport_receivers</a>
    </li>
    <li>
      <a href="../articles/runQC.html">runQC</a>
    </li>
    <li>
      <a href="../articles/extractEnv.html">extractEnv</a>
    </li>
    <li>
      <a href="../articles/extractBlue.html">extractBlue</a>
    </li>
    <li>
      <a href="../articles/extractMoor.html">extractMoor</a>
    </li>
  </ul></li>
<li>
  <a href="https://github.com/IMOS-AnimalTracking/remora" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract and append Bluelink Reanalysis (BRAN) environmental data to detection data</h1>
    <small class="dont-index">Source: <a href="https://github.com/IMOS-AnimalTracking/remora/blob/HEAD/R/extractBlue.R" class="external-link"><code>R/extractBlue.R</code></a></small>
    <div class="hidden name"><code>extractBlue.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Accesses and download environmental data from the Bluelink (CSIRO)
server and append variables to detection data based on date of detection</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extractBlue</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">datetime</span>,</span>
<span>  <span class="va">env_var</span>,</span>
<span>  extract_depth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  var_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">env_var</span>, <span class="va">extract_depth</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>,</span>
<span>  folder_name <span class="op">=</span> <span class="st">"Bluelink"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cache_layers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  full_timeperiod <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  station_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fill_gaps <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  export_step <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  export_path <span class="op">=</span> <span class="st">"Processed_data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df</dt>
<dd><p>detection data source in data frame with at the minimum a X, Y and
date time field</p></dd>


<dt>X</dt>
<dd><p>name of column with X coordinate or longitude (EPSG 4326)</p></dd>


<dt>Y</dt>
<dd><p>name of column with Y coordinate or latitude (EPSG 4326)</p></dd>


<dt>datetime</dt>
<dd><p>name of column with date time stamp (Coordinated Universal
Time; UTC)</p></dd>


<dt>env_var</dt>
<dd><p>variable needed from Bluelink. Options include ('ocean_temp', 'ocean_salt',
ocean_u', 'ocean_v', 'ocean_w', 'ocean_eta_t', 'air_wind')</p></dd>


<dt>extract_depth</dt>
<dd><p>Bluelink data is 3D, so data can be obtained either at the water surface or at depth. Please
provide the depth of interest (between 0 and 4,509 m) as numeric and the function will automatically obtain the data at
the nearest available layer. By default the data will be extracted at the water surface.</p></dd>


<dt>var_name</dt>
<dd><p>name for the column including the extracted environmental data. Can be usefull if the user wants to
download the same environmental data at different depths. If not specified, it will be chosen based on the env_var and
extract_depth arguments.</p></dd>


<dt>folder_name</dt>
<dd><p>name of folder within the working directory where the downloaded and processed
netCDF files should be saved. Default (NULL) produces automatic folder names based on study extent and deletes
processed files after processing.</p></dd>


<dt>verbose</dt>
<dd><p>should function provide details of what operation is being conducted.
Set to <code>FALSE</code> to keep it quiet</p></dd>


<dt>cache_layers</dt>
<dd><p>should the downloaded and processed environmental data be cached within
the working directory? If FALSE (default), the Bluelink data will be stored in a temporary folder
and discarded after environmental extraction. Otherwise, it will be saved in the "cached" folder
within folder_name.</p></dd>


<dt>full_timeperiod</dt>
<dd><p>should environmental variables be extracted for each day
across full monitoring period? This option is time and memory consuming for long projects. If this option is selected,
the returned dataset will be standardized for the days with/without detections across all stations (station_name column) where animals were
detected. For more details please see the package vignettes.</p></dd>


<dt>station_name</dt>
<dd><p>if full_timeperiod = TRUE, please provide the column that identifies the name of the
acoustic stations</p></dd>


<dt>fill_gaps</dt>
<dd><p>should the function use a spatial buffer to estimate
environmental variables for detections where there is missing data. Default
is <code>FALSE</code> to save computational time.</p></dd>


<dt>buffer</dt>
<dd><p>radius of buffer (in m) around each detection from which
environmental variables should be extracted from. A median value of pixels
that fall within the buffer will be used if <code>fill_gaps = TRUE</code>. If <code>NULL</code> a
buffer will be chosen based on the resolution of environmental layer. A
numeric value (in m) can be used here to customise buffer radius.</p></dd>


<dt>export_step</dt>
<dd><p>should the processed dataset be exported to file? This is particularly usefull for large
datasets, to avoid function failure due to issues with internet connexion. The rows with missing data will be
exported as NAs, and only these will be completed if the function is rerun providing the exported dataset as input (df)</p></dd>


<dt>export_path</dt>
<dd><p>path and name of to export the dataset with appended environmnetal data</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a dataframe with the environmental variable appended as an extra
column based on date of each detection</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The <code>extractBlue</code> function allows the user to download, process and
append a range of 3D environmental variables (between the water surface to 4,509 m depth)
to each detection within a telemetry data set.
We advocate for users to first undertake a quality control step using
the <code><a href="runQC.html">runQC</a></code> function before further analysis, however the
functionality to append environmental data will work on any dataset that has
at the minimum spatial coordinates (i.e., latitude, longitude; in EPSG 4326)
and a timestamp (in UTC) for each detection event. Quality controlled
environmental variables housed in the Bluelink (BRAN) CSIRO server will be extracted
for each specific coordinate at the specific timestamp where available. A
summary table of the full range of environmental variables currently
available can be accessed using the <code><a href="imos_variables.html">imos_variables</a></code> function.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Input example detection dataset that have run through the quality control</span></span></span>
<span class="r-in"><span><span class="co">##   workflow (see 'runQC' function)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TownsvilleReefQC"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## simplify &amp; subset data for speed</span></span></span>
<span class="r-in"><span><span class="va">qc_data</span> <span class="op">&lt;-</span> </span></span>
<span class="r-in"><span>  <span class="va">TownsvilleReefQC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">QC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Detection_QC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">filename</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extract daily interpolated sea surface temperature</span></span></span>
<span class="r-in"><span><span class="co">## cache_layers &amp; fill_gaps args set to FALSE for speed</span></span></span>
<span class="r-in"><span><span class="va">data_with_temp</span> <span class="op">&lt;-</span> </span></span>
<span class="r-in"><span>   <span class="fu">extractBlue</span><span class="op">(</span>df <span class="op">=</span> <span class="va">qc_data</span>,</span></span>
<span class="r-in"><span>               X <span class="op">=</span> <span class="st">"receiver_deployment_longitude"</span>, </span></span>
<span class="r-in"><span>               Y <span class="op">=</span> <span class="st">"receiver_deployment_latitude"</span>, </span></span>
<span class="r-in"><span>               datetime <span class="op">=</span> <span class="st">"detection_datetime"</span>, </span></span>
<span class="r-in"><span>               env_var <span class="op">=</span> <span class="st">"ocean_temp"</span>,</span></span>
<span class="r-in"><span>               extract_depth <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>               folder_name <span class="op">=</span> <span class="st">"Bluelink"</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>               fill_gaps <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Downloading and processing ocean_temp_0 data: 2013-08 | 2013-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                    |                                                            |   0%  |                                                                    |==============================                              |  50%  |                                                                    |============================================================| 100%</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Fabrice Jaine, Ian Jonsen, Vinay Udyawer, Ross Dwyer, Kylie Scales, Francisca Maron, Xavier Hoenner, Charlie Huveneers, Yuri Niella.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

