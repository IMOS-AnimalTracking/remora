<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>extractMoor • remora</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="extractMoor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">remora</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="">0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shinyReport_transmitters.html">shinyReport_transmitters</a>
    </li>
    <li>
      <a href="../articles/shinyReport_receivers.html">shinyReport_receivers</a>
    </li>
    <li>
      <a href="../articles/runQC.html">runQC</a>
    </li>
    <li>
      <a href="../articles/extractEnv.html">extractEnv</a>
    </li>
    <li>
      <a href="../articles/extractBlue.html">extractBlue</a>
    </li>
    <li>
      <a href="../articles/extractMoor.html">extractMoor</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/IMOS-AnimalTracking/remora" class="external-link">
    <span class="fa fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="extractMoor_files/kePrint-0.0.1/kePrint.js"></script><link href="extractMoor_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>extractMoor</h1>
            <h3 data-toc-skip class="subtitle">Integrating in-situ
moorings data from the National Mooring Network with QC’d animal
detections</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/IMOS-AnimalTracking/remora/blob/v0.9/vignettes/extractMoor.Rmd" class="external-link"><code>vignettes/extractMoor.Rmd</code></a></small>
      <div class="hidden name"><code>extractMoor.Rmd</code></div>

    </div>

    
    
<hr>
<p>Another key functionality of the <code>remora</code> package allows
users to integrate acoustic telemetry data with physical and biological
parameters collected on the <a href="https://imos.org.au/facilities/nationalmooringnetwork" class="external-link">IMOS
National Mooring Network</a>. The National Mooring Network is a
collection of mooring arrays strategically positioned in Australian
coastal waters that includes regional arrays of shelf moorings,
acidification moorings, acoustic observatories and a network of National
Reference Stations. This package allows the user to match environmental
data collected from these mooring stations to each tag detection.
Associating environmental data to detections provides a means to analyse
environmental or habitat drivers of occurrence, presence and movement of
animal monitored using acoustic telemetry.</p>
<p>We advocate for users to first undertake a quality control step using
the <code><a href="../reference/runQC.html">runQC()</a></code> function and workflow before further analysis
(see <code><a href="../articles/runQC.html">vignette('runQC')</a></code>), however the functionality to
append environmental data will work on any dataset that has at the
minimum spatial coordinates and a timestamp for each detection event.
Currently, the focus of this package is to integrate animal telemetry
data and environmental data housed within the <a href="https://imos.org.au" class="external-link">Integrated Marine Observing System</a>, and
therefore primarily focuses within Australia. As this package develops,
more sources of environmental data will be added to allow for users to
access more datasets across Australia and globally.</p>
<p><br></p>
<div class="section level2">
<h2 id="types-of-environmental-data">Types of environmental data<a class="anchor" aria-label="anchor" href="#types-of-environmental-data"></a>
</h2>
<p>This package allows users to access a range of ocean datasets that
have undergone a quality control process and housed within the <a href="https://imos.org.au" class="external-link">Integrated Marine Observing System</a>
database and can also be explored through the <a href="https://portal.aodn.org.au" class="external-link">Australian Ocean Data Network
portal</a>. There are primarily two types of environmental data that
users can currently access:</p>
<p><em>1. Remote sensed environmental data</em></p>
<p><em>2. In-situ environmental data from moorings at fixed
locations</em></p>
<p><br></p>
<p>The <code><a href="../reference/imos_variables.html">imos_variables()</a></code> function will help the user
identify currently available environmental layers that can be accessed
and associated. Variables include spatial layers including
<code>bathy</code> and <code>dist_to_land</code>, which provide distance
measures of bathymetry (in meters) and proximity to land (in
kilometers). Variable names that start with <code>rs_</code> are remote
sensed environmental layers, and variables starting with
<code>moor_</code> include in-situ environmental layers.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/IMOS-AnimalTracking/remora/" class="external-link">remora</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/imos_variables.html">imos_variables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table  lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Platform
</th>
<th style="text-align:left;">
Temporal resolution
</th>
<th style="text-align:left;">
Units
</th>
<th style="text-align:left;">
Function to use
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Source
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
bathy
</td>
<td style="text-align:left;">
Composite raster product
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
meters
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Australian Bathymetry and Topography Grid. 250 m resolution.
</td>
<td style="text-align:left;">
Geosciences Australia
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
dist_to_land
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
kilometers
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Distance from nearest shoreline (in km). Derived from the
high-resolution Open Street Map shoreline product.
</td>
<td style="text-align:left;">
This package
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_sst
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
1-day multi-swath multi-sensor (L3S) remotely sensed sea surface
temperature (degrees Celcius) at 2 km resolution. Derived from the Group
for High Resolution Sea Surface Temperature (GHRSST)
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_sst_interpolated
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (2006-06-12 - present)
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
1-day interpolated remotely sensed sea surface temperature (degrees
Celcius) at 9 km resolution. Derived from the Regional Australian
Multi-Sensor Sea surface temperature Analysis (RAMSSA, Beggs et
al. 2010) system as part of the BLUElink Ocean Forecasting Australia
project
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_chl
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
mg.m-3
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Remotely sensed chlorophyll-a concentration (OC3 model). Derived from
the MODIS Aqua satellite mission. Multi-spectral measurements are used
to infer the concentration of chlorophyll-a, most typically due to
phytoplankton, present in the water (mg.m-3).
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_current
</td>
<td style="text-align:left;">
Composite raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1; degrees
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Gridded (adjusted) sea level anomaly (GSLA), surface geostrophic
velocity in the east-west (UCUR) and north-south (VCUR) directions for
the Australasian region derived from the IMOS Ocean Current project. Two
additional variables are calculated: surface current velocity (ms-1) and
bearing (degrees).
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_salinity
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
weekly (2011-08-25 - 2015-06-07)
</td>
<td style="text-align:left;">
psu
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
7-day composite remotely sensed salinity. Derived from the NASA Aquarius
satellite mission (psu).
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_turbidity
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
m-1
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Diffuse attenuation coefficient at 490 nm (K490) indicates the turbidity
of the water column (m-1). The value of K490 represents the rate which
light at 490 nm is attenuated with depth. For example a K490 of
0.1/meter means that light intensity will be reduced one natural log
within 10 meters of water. Thus, for a K490 of 0.1, one attenuation
length is 10 meters. Higher K490 value means smaller attenuation depth,
and lower clarity of ocean water.
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_npp
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
mgC.m_2.day-1
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Net primary productivity (OC3 model and Eppley-VGPM algorithm). Modelled
product used to compute an estimate of the Net Primary Productivity
(NPP). The model used is based on the standard vertically generalised
production model (VGPM). The VGPM is a “chlorophyll-based” model that
estimates net primary production from chlorophyll using a
temperature-dependent description of chlorophyll-specific photosynthetic
efficiency. For the VGPM, net primary production is a function of
chlorophyll, available light, and the photosynthetic efficiency. The
only difference between the Standard VGPM and the Eppley-VGPM is the
temperature-dependent description of photosynthetic efficiencies, with
the Eppley approach using an exponential function to account for
variation in photosynthetic efficiencies due to photoacclimation.
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_sea_temp
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of sea
temperature (degrees Celcius) at fixed mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_psal
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
psu
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of salinity
(psu) at fixed mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_ucur
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
ms-1
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of subsurface
geostrophic current velocity in the east-west direction (ms-1) at fixed
mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_vcur
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
ms-1
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of subsurface
geostrophic current velocity in the north-south direction (ms-1) at
fixed mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_temp
</td>
<td style="text-align:left;">
3D Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Water temperature at specified depth from the surface to 4,509-m depth
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_salt
</td>
<td style="text-align:left;">
3D Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
psu
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Water salinity at specified depth from the surface to 4,509-m depth
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_cur
</td>
<td style="text-align:left;">
3D Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1; degrees clockwise
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Geostrophic velocity in the east-west (UCUR) and north-south (VCUR)
directions from the surface to 4,509-m depth. Two additional variables
are calculated: BRAN_spd = current velocity (ms-1) and BRAN_dir =
current bearing (degrees).
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_wcur
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Vertical current speed in the water column is calculated (negative =
downwards; positive = upwards) using the layers available between the
surface to 200-m depths.
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_ssh
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
meters
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Sea surface height at the water surface
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_mld
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
meters
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Mixed layer depth in relation to the water surface
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_wind
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1; degrees clockwise
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Two variables are calculated, including BRAN_wind_spd = wind velocity
(ms-1) and BRAN_wind_dir = wind bearing (degrees).
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>In this vignette we will explore accessing and extracting in-situ
data from the <a href="https://imos.org.au/facilities/nationalmooringnetwork" class="external-link">IMOS
National Mooring Network</a>. A suite of additional functions is also
available to access enbvironmental data gatehred via remote sensing (see
<code><a href="../articles/extractEnv.html">vignette('extractEnv')</a></code>).</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="usage-of-the-extractmoor-function">Usage of the <code>extractMoor()</code> function<a class="anchor" aria-label="anchor" href="#usage-of-the-extractmoor-function"></a>
</h2>
<div class="section level3">
<h3 id="load-example-dataset">Load example dataset<a class="anchor" aria-label="anchor" href="#load-example-dataset"></a>
</h3>
<p>The primary function to extract and append in-situ data collected by
the <a href="https://imos.org.au/facilities/nationalmooringnetwork" class="external-link">IMOS
National Mooring Network</a> to acoustic detection data is the
<code><a href="../reference/extractMoor.html">extractMoor()</a></code> function. Lets start with a dataset that has
undergone quality control (see <code><a href="../articles/runQC.html">vignette('runQC')</a></code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Example dataset that has undergone quality control using the `runQC()` function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TownsvilleReefQC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Un-nest the output and retain detections flagged as 'valid' and 'likely valid' (Detection_QC 1 and 2)</span></span>
<span><span class="va">qc_data</span> <span class="op">&lt;-</span> <span class="va">TownsvilleReefQC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">QC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Detection_QC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><br></p>
<p>Lets have a quick look at the spatial patterns in detection data for
each tag deployment:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/" class="external-link">ggspatial</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">qc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">transmitter_id</span>, <span class="va">station_name</span>, <span class="va">installation_name</span>, <span class="va">receiver_deployment_longitude</span>, <span class="va">receiver_deployment_latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_map_tile</span><span class="op">(</span><span class="st">'cartolight'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatial_point</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receiver_deployment_longitude</span>, </span>
<span>                         y <span class="op">=</span> <span class="va">receiver_deployment_latitude</span>, </span>
<span>                         size <span class="op">=</span> <span class="va">num_det</span>, </span>
<span>                         color <span class="op">=</span> <span class="va">installation_name</span><span class="op">)</span>, </span>
<span>                     crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">transmitter_id</span>,nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/env_extract/env_extract_plot1.png"><br></p>
<p>We can also have a look at the temporal pattern in detections:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">transmitter_id</span>, <span class="va">date</span>, <span class="va">installation_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">transmitter_id</span>, color <span class="op">=</span> <span class="va">installation_name</span>, size <span class="op">=</span> <span class="va">num_det</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/env_extract/env_extract_plot2.png"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="moorings-data-source">Moorings data source<a class="anchor" aria-label="anchor" href="#moorings-data-source"></a>
</h3>
<p>Lets have a quick look at the spatial arrangement of the IMOS
National Mooring Network.</p>
<p>In this example, we will identify and plot the location of moorings
in Australian coastal waters which have records of <em>sea water
temperature</em></p>
<p>Each variable will need to be accessed one at a time using the
<code><a href="../reference/mooringDownload.html">mooringDownload()</a></code> function. There is only one parameter
within the function that can help the user identify the variable
required:</p>
<ul>
<li>
<strong>sensorType</strong>: the name of the environmental variable
to download and append. This can be <code>temperature</code>,
<code>velocity</code>, <code>salinity</code>, <code>oxygen</code>.
<br>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a table containing IMOS moorings metadata for only those moorings with temperature data</span></span>
<span><span class="va">moorT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mooringTable.html">mooringTable</a></span><span class="op">(</span>sensorType<span class="op">=</span><span class="st">"temperature"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PLot the location of the moorings with associated metadata</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addMarkers</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="va">moorT</span><span class="op">$</span><span class="va">longitude</span>, lat <span class="op">=</span> <span class="va">moorT</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>             popup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Site code"</span>, <span class="va">moorT</span><span class="op">$</span><span class="va">site_code</span>,<span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"URL:"</span>, <span class="va">moorT</span><span class="op">$</span><span class="va">url</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"Standard names:"</span>, <span class="va">moorT</span><span class="op">$</span><span class="va">standard_names</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"Coverage start:"</span>, <span class="va">moorT</span><span class="op">$</span><span class="va">time_coverage_start</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"Coverage end:"</span>, <span class="va">moorT</span><span class="op">$</span><span class="va">time_coverage_end</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot3.png"><br></p>
</div>
<div class="section level3">
<h3 id="find-closest-mooring-to-our-animal-detections">Find closest mooring to our animal detections<a class="anchor" aria-label="anchor" href="#find-closest-mooring-to-our-animal-detections"></a>
</h3>
<p>To identify which is the appropriate mooring with which to append to
our acoustic detections, we’ll run the <code><a href="../reference/getDistance.html">getDistance()</a></code>
function. This function will assign the <code>moor_site_code</code> of
the closest mooring to each tag detection, the straight line distance of
the mooring to the receiver station location
(<code>closest_moor_km</code>), along with the mooring’s temporal
coverage (<code>moor_coverage_start</code> and
<code>moor_coverage_end</code>), and whether or not the
<code>detection_datetime</code> stamp falls within this coverage period
(<code>is.coverage</code> = TRUE/FALSE).</p>
<p>In this function, the user specifies which detection dataset with
which they which to merge with the available moorings data.</p>
<ul>
<li>
<strong>moorLocations</strong>: the dataframe containing the
locations of the IMOS moorings generated using the
<code><a href="../reference/mooringTable.html">mooringTable()</a></code> function.</li>
<li>
<strong>trackingData</strong>: the dataframe containing acoustic
detection data in IMOS QC format</li>
</ul>
<p><br></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Extract the nearest mooring to each station where a tag was detected</span></span>
<span><span class="va">det_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDistance.html">getDistance</a></span><span class="op">(</span>trackingData <span class="op">=</span> <span class="va">qc_data</span>, </span>
<span>                        moorLocations <span class="op">=</span> <span class="va">moorT</span>,</span>
<span>                        X <span class="op">=</span> <span class="st">"receiver_deployment_longitude"</span>,</span>
<span>                        Y <span class="op">=</span> <span class="st">"receiver_deployment_latitude"</span>,</span>
<span>                        datetime <span class="op">=</span> <span class="st">"detection_datetime"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="section"></h3>
<p>In order to identify which moorings do not have temporal coverage
during the period when tag detections were obtained, we have provided
the <code><a href="../reference/getOverlap.html">getOverlap()</a></code> function. In this function, we simply
enter the detection dataset (<code>det_dist</code>) which also contains
the nearest moorings data generated using the above
<code><a href="../reference/getDistance.html">getDistance()</a></code> function. What is returned is a table
containing the proportion of tag detections that fell within the
coverage period of the mooring deployment at which it was assigned:
<code>moor_site_code</code>, <code>moor_coverage_start</code> and
<code>moor_coverage_end</code>.</p>
<p><br></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which moorings have overlapping data with detections?</span></span>
<span><span class="va">mooring_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getOverlap.html">getOverlap</a></span><span class="op">(</span><span class="va">det_dist</span><span class="op">)</span></span>
<span><span class="va">mooring_overlap</span></span></code></pre></div>
<p>As <code>Poverlap = 1</code> for all three moorings datasets, all our
detections have temporal overlap with these mooring deployments. IF some
of the moorings had partial/no coverage during the tag release period,
we would consider dropping these from the moorT object before re-running
the <code><a href="../reference/getDistance.html">getDistance()</a></code> function.</p>
<p>Let’s plot the spatial arrangement of these mooring stations on an
interactive map with our tag detections at receiver stations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for only those moorings which are closest to receivers and also have overlapping detection intervals</span></span>
<span><span class="va">moorT_new</span> <span class="op">&lt;-</span> <span class="va">moorT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">site_code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mooring_overlap</span><span class="op">$</span><span class="va">moor_site_code</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Summarise dataset so only a single row per receiver station</span></span>
<span><span class="va">qs_stat</span> <span class="op">&lt;-</span> <span class="va">qc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">station_name</span>, <span class="va">installation_name</span>, </span>
<span>           <span class="va">receiver_deployment_longitude</span>, </span>
<span>           <span class="va">receiver_deployment_latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            first_detection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span>,</span>
<span>            last_detection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make palette for number of detections at stations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/" class="external-link">viridisLite</a></span><span class="op">)</span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">qs_stat</span><span class="op">$</span><span class="va">num_det</span><span class="op">)</span> <span class="co"># get domain of numeric data for colour scalse</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html" class="external-link">colorNumeric</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, domain <span class="op">=</span> <span class="va">domain</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw the map</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addMarkers</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="va">moorT_new</span><span class="op">$</span><span class="va">longitude</span>, lat <span class="op">=</span> <span class="va">moorT_new</span><span class="op">$</span><span class="va">latitude</span>, </span>
<span>             popup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Site code"</span>, <span class="va">moorT_new</span><span class="op">$</span><span class="va">site_code</span>,<span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"URL:"</span>, <span class="va">moorT_new</span><span class="op">$</span><span class="va">url</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"Standard names:"</span>, <span class="va">moorT_new</span><span class="op">$</span><span class="va">standard_names</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"Start:"</span>, <span class="va">moorT_new</span><span class="op">$</span><span class="va">time_coverage_start</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                           <span class="st">"End:"</span>, <span class="va">moorT_new</span><span class="op">$</span><span class="va">time_coverage_end</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">qs_stat</span>,</span>
<span>                   lng <span class="op">=</span> <span class="va">qs_stat</span><span class="op">$</span><span class="va">receiver_deployment_longitude</span>, </span>
<span>                   lat <span class="op">=</span> <span class="va">qs_stat</span><span class="op">$</span><span class="va">receiver_deployment_latitude</span>,</span>
<span>                   radius <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                   color<span class="op">=</span><span class="op">~</span><span class="fu">pal</span><span class="op">(</span><span class="va">num_det</span><span class="op">)</span>,</span>
<span>                   stroke<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                   fillOpacity<span class="op">=</span><span class="fl">0.5</span>,</span>
<span>                   popup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Station name"</span>, <span class="va">qs_stat</span><span class="op">$</span><span class="va">station_name</span>,<span class="st">"&lt;br&gt;"</span>,</span>
<span>                                 <span class="st">"Installation name:"</span>, <span class="va">qs_stat</span><span class="op">$</span><span class="va">installation_name</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                                 <span class="st">"Tag detections:"</span>, <span class="va">qs_stat</span><span class="op">$</span><span class="va">num_det</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                                 <span class="st">"First tag detection:"</span>,<span class="va">qs_stat</span><span class="op">$</span><span class="va">first_detection</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>                                 <span class="st">"Last tag detection:"</span>,<span class="va">qs_stat</span><span class="op">$</span><span class="va">last_detection</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot4.png"><br></p>
</div>
<div class="section level3">
<h3 id="moorings-data-download">Moorings data download<a class="anchor" aria-label="anchor" href="#moorings-data-download"></a>
</h3>
<p>Now that we have matched each animal detection with an appropriate
<code>moor_site_code</code>, we will download the data time series for
<em>moorings derived water temperature</em> for each mooring site code
from the AODN Thredds file sever.</p>
<p>Although this function provides the capacity to download various
sensor types (i.e. <code>temperature</code>, <code>velocity</code>,
<code>salinity</code> or <code>oxygen</code>), each variable can only be
accessed one at a time using the <code><a href="../reference/mooringDownload.html">mooringDownload()</a></code>
function. The netCDF files should then be saved locally within the
working directory (e.g. within the folder
<code>imos.cache/moor/temperature</code>).</p>
<p>There are a few parameters within the function that can help the user
identify the variable required, and to manage the downloaded
environmental layers:</p>
<ul>
<li>
<strong>moor_site_codes</strong>: a vector containing the names of
the mooring sites to download</li>
<li>
<strong>sensorType</strong>: the name of the environmental variable
to download and append (see <code><a href="../reference/imos_variables.html">imos_variables()</a></code> for available
variables and variable names)</li>
<li>
<strong>fromWeb</strong>: should the environmental data layers be
directly loaded from the web (<code>TRUE</code>) or uploaded from an
existing folder within the working directory (<code>FALSE</code>)?<br>
</li>
<li>
<strong>file_loc</strong>: the name of the folder within the working
directory where the NetCDFs will be saved (if
<code>fromWeb = TRUE</code>) or uploaded (if
<code>fromWeb = FALSE</code>)</li>
<li>
<strong>itimeout</strong>: number of seconds we are willing to wait
before timeout to download netcdf from the web. Defaults to 60</li>
</ul>
<p><br></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Creates vector of moorings that we want to download</span></span>
<span><span class="va">moorIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mooring_overlap</span><span class="op">$</span><span class="va">moor_site_code</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Download each net cdf from the Thredds server to a specified folder</span></span>
<span><span class="co">## set fromWeb = FALSE if loading from an existing folder within the working directory</span></span>
<span><span class="va">moorDat.l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mooringDownload.html">mooringDownload</a></span><span class="op">(</span>moor_site_codes <span class="op">=</span> <span class="va">moorIDs</span>, </span>
<span>                             sensorType<span class="op">=</span><span class="st">"temperature"</span>, </span>
<span>                             fromWeb <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             file_loc<span class="op">=</span><span class="st">"imos.cache/moor/temperature"</span>,</span>
<span>                             itimeout<span class="op">=</span><span class="fl">240</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">moorDat.l</span><span class="op">)</span> <span class="co"># What moorings datasets do we have in memory</span></span>
<span><span class="co">#[1] "GBRMYR" "GBRPPS" "NRSYON"</span></span></code></pre></div>
<p><br></p>
<p>As we set <code>fromWeb</code> to <code>TRUE</code>, the downloaded
layers will be cached within the specified <strong>file_loc</strong>
folder within the working directory. Each time the function is called,
downloaded layers are cached into this folder.</p>
<p>When downloading <code>temperature</code> data, two variables are
downloaded: sensor depth (<code>moor_depth</code>) and sea temperature
(<code>moor_sea_temp</code>).</p>
<p>When downloading <code>current</code> data, three variables are
downloaded: sensor depth (<code>moor_depth</code>), surface geostrophic
velocity in the north-south direction (<code>moor_vcur</code>) and the
east-west direction (<code>moor_ucur</code>).</p>
<p>When downloading <code>salinity</code> data, two variables are
downloaded: sensor depth (<code>moor_depth</code>), and sea water
practical salinity (<code>moor_psal</code>).</p>
<p>When downloading dissolved <code>oxygen</code> data, four variables
are downloaded: sensor depth (<code>moor_depth</code>),
<code>moor_mole_concentration_of_dissolved_molecular_oxygen_in_sea_water</code>,
<code>moor_moles_of_oxygen_per_unit_mass_in_sea_water</code> and
<code>moor_volume_concentration_of_dissolved_molecular_oxygen_in_sea_water</code>.
<br></p>
</div>
<div class="section level3">
<h3 id="creating-a-depth-time-plot-using-moorings-data-and-adding-detections">Creating a depth-time plot using moorings data, and adding
detections<a class="anchor" aria-label="anchor" href="#creating-a-depth-time-plot-using-moorings-data-and-adding-detections"></a>
</h3>
<p>We can use the moorings data we’ve extracted to plot an interactive
depth-time plot showing three-dimensional variability in the physical
parameter of interest over a specified time period, and then plot the
animal tracking detections which are close to this mooring. When
hovering on the plot, a vertical line will appear so that it is easier
to find the environmental variable associated to the detection.</p>
<p>For example, we might want to plot temperature over depth at the
GBRPPS mooring, <code>GBRPPS</code>, and then add all the bull shark
detections over the same time period from the closest IMOS Animal
Tracking Facility installation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotDT.html">plotDT</a></span><span class="op">(</span>moorData<span class="op">=</span><span class="va">moorDat.l</span><span class="op">$</span><span class="va">GBRPPS</span>, <span class="co"># have GBRMYR, GBRPPS and NRSYON available</span></span>
<span>       moorName<span class="op">=</span><span class="st">"GBRPPS"</span>,</span>
<span>       dateStart<span class="op">=</span><span class="st">"2013-11-01"</span>, </span>
<span>       dateEnd<span class="op">=</span><span class="st">"2014-02-01"</span>, </span>
<span>       varName<span class="op">=</span><span class="st">"temperature"</span>,</span>
<span>       trackingData<span class="op">=</span><span class="va">det_dist</span>,</span>
<span>       speciesID<span class="op">=</span><span class="st">"Carcharhinus leucas"</span>,</span>
<span>       IDtype<span class="op">=</span><span class="st">"species_scientific_name"</span>,</span>
<span>       detStart<span class="op">=</span><span class="st">"2013-11-01"</span>, </span>
<span>       detEnd<span class="op">=</span><span class="st">"2014-02-01"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot5.png"></p>
<p>We can also visualise current <code>velocity</code> data with the
detections, where moorings have velocity sensors. For example, we can
visualise the zonal, North-South (v) velocity (<code>vcur</code>) at the
the same mooring, and plot the bull shark detections associated with
that mooring.</p>
<p>We need to make sure that the NetCDF file we have stored locally
contains the velocity data. To achieve this, we firstly need to download
this netCDF file using the <code><a href="../reference/mooringDownload.html">mooringDownload()</a></code> function and
then save the file to a different folder location, in this case
<code>imos.cache/moor/velocity</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotDat.l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mooringDownload.html">mooringDownload</a></span><span class="op">(</span>moor_site_codes <span class="op">=</span> <span class="st">"GBRPPS"</span>, </span>
<span>                             fromWeb <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Download the netCDF. If already downloaded, set as FALSE</span></span>
<span>                             sensorType<span class="op">=</span><span class="st">"velocity"</span>, <span class="co"># sensor data to download</span></span>
<span>                             file_loc<span class="op">=</span><span class="st">"imos.cache/moor/velocity"</span>, <span class="co"># Location where the netCDF is stored/saved</span></span>
<span>                             itimeout<span class="op">=</span><span class="fl">240</span><span class="op">)</span> </span>
<span>            </span>
<span><span class="co"># plot the moorings data</span></span>
<span><span class="fu"><a href="../reference/plotDT.html">plotDT</a></span><span class="op">(</span>moorData<span class="op">=</span><span class="va">plotDat.l</span><span class="op">$</span><span class="va">GBRPPS</span>, </span>
<span>       moorName<span class="op">=</span><span class="st">"GBRPPS"</span>,</span>
<span>       dateStart<span class="op">=</span><span class="st">"2013-11-01"</span>, </span>
<span>       dateEnd<span class="op">=</span><span class="st">"2014-02-01"</span>, </span>
<span>       varName <span class="op">=</span> <span class="st">"vcur"</span>,</span>
<span>       trackingData<span class="op">=</span><span class="va">det_dist</span>,</span>
<span>       speciesID<span class="op">=</span><span class="st">"Carcharhinus leucas"</span>,</span>
<span>       IDtype<span class="op">=</span><span class="st">"species_scientific_name"</span>,</span>
<span>       detStart<span class="op">=</span><span class="st">"2013-11-01"</span>,</span>
<span>       detEnd<span class="op">=</span><span class="st">"2014-02-01"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot6.png"></p>
</div>
<div class="section level3">
<h3 id="moorings-data-extraction">Moorings data extraction<a class="anchor" aria-label="anchor" href="#moorings-data-extraction"></a>
</h3>
<p>Say we wanted to match each animal tag detection to the nearest
mooring sensor value. How would we achieve this?</p>
<p>In this example, we will extract <em>moorings derived water
temperature</em> collected from the nearest sensor in the <a href="https://imos.org.au/facilities/nationalmooringnetwork" class="external-link">IMOS
National Mooring Network</a> to a tag detection at an acoustic
receiver.</p>
<p>Sea water <code>temperature</code>, current <code>velocity</code>, or
<code>salinity</code> data can be accessed one at a time using the
<code><a href="../reference/extractMoor.html">extractMoor()</a></code> function. There are a few parameters within
the function that can help the user identify the variable required, and
to manage the downloaded environmental layers:</p>
<ul>
<li>
<strong>trackingData</strong>: the data frame with the detection
data</li>
<li>
<strong>file_loc</strong>: the name of the folder where the NetCDF
files for the moorings are stored</li>
<li>
<strong>sensorType</strong>: name of mooring sensor to query. Can be
<code>temperature</code>, <code>velocity</code> or
<code>salinity</code>.</li>
<li>
<strong>timeMaxh</strong>: optional numeric string containing the
maximum time threshold in hours to merge detection and mooring sensor
values. The default value is <code>Inf</code>, which allows to run the
function without a timeout threshold.</li>
<li>
<strong>distMaxkm</strong>: optional numeric string containing the
maximum distance threshold in kilometers to include in output. The
default value is <code>Inf</code>, which allows to run the function
without distance threshold.</li>
<li>
<strong>targetDepthm</strong>: extracts the nearest sensor to this
depth value. The default value is <code>NA</code>, which returns all
sensor records at this mooring</li>
<li>
<strong>scalc</strong>: when there are two options for sensors
nearest the idepth provided, should the lower (<code>min</code>) or
higher (<code>max</code>) depth value be returned? Users can also
specify a <code>mean</code> of the available values, or <code>NA</code>
to return both sensor values.</li>
</ul>
<p><br></p>
<p>By default, each of the environmental sensors positioned on a mooring
will be returned for a certain timestamp. For example, if 10 sensors are
positioned on a mooring, each hourly timestamp for that mooring witll
have 10 sensor readings.</p>
<p><br></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_mooring_sst_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractMoor.html">extractMoor</a></span><span class="op">(</span>trackingData <span class="op">=</span> <span class="va">det_dist</span>,</span>
<span>                                         file_loc<span class="op">=</span><span class="st">"imos.cache/moor/temperature"</span>,</span>
<span>                                         sensorType <span class="op">=</span> <span class="st">"temperature"</span>,</span>
<span>                                         timeMaxh <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>                                         distMaxkm <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<p>We can see the extracted environmental variables are appended as new
columns to the input dataset as a nested tibble. You can look at the
contents of this by using the <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest()</a></code> function in the
<code>tidyr</code> package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_mooring_sst_all</span> <span class="co"># By default the output is a nested tibble</span></span>
<span></span>
<span><span class="co"># Unnest tibble to reveal the first 10 rows of the data</span></span>
<span><span class="va">data_with_mooring_sst_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>If we wanted to extract the sensor positioned at the shallowest depth
available on a mooring, we can do so by setting the parameter
<code>idepth = 0</code>. Alternatively if there is a preferred depth at
which you would like to extract, the function will select the nearest
sensor to this value.<br><br></p>
<p>You can increase the sensitivity of the <code><a href="../reference/extractMoor.html">extractMoor()</a></code>
function by setting a maximum time threshold (in hours) for the period
you are willing to allow between tag detection and mooring timestamps
(<code>timeMaxh</code>). You can also add a distance threshold
(<code>distMaxkm</code>) for maximum allowed distance (in kilometers)
between moorings and receiver station locations.</p>
<p>In this example, we will limit our function so that only detections
within 24h and 50km of moorings are allocated with sensor value
readings.</p>
<p>As each mooring line has multiple sensors deployed at various depths,
we can specify which sensor we want returned by setting a
<code>targetDepthm</code>. Here we set this as
<code>targetDepthm=0</code> to return the sensor value that is nearest
to the water surface.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the same function again with time and distance thresholds</span></span>
<span><span class="co"># and when multiple sensors are available return the shallowest value at that time stamp</span></span>
<span><span class="va">data_with_mooring_sst_shallow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractMoor.html">extractMoor</a></span><span class="op">(</span>trackingData <span class="op">=</span> <span class="va">det_dist</span>,</span>
<span>                                             file_loc<span class="op">=</span><span class="st">"imos.cache/moor/temperature"</span>,</span>
<span>                                             sensorType <span class="op">=</span> <span class="st">"temperature"</span>,</span>
<span>                                             timeMaxh <span class="op">=</span> <span class="fl">24</span>,</span>
<span>                                             distMaxkm <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                             targetDepthm<span class="op">=</span><span class="fl">0</span>, </span>
<span>                                             scalc<span class="op">=</span><span class="st">"min"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_with_mooring_sst_shallow</span></span></code></pre></div>
<p>Notice that this new merged dataset
<code>data_with_mooring_sst_shallow</code> is now much smaller than the
original one <code>data_with_mooring_sst_all</code>? This is because we
have extracted only selected a single sensor value for each detection
timestamp. We have also dropped those rows from the dataset which not
did meet the time and distance thresholds.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="examining-the-appended-environmental-data">Examining the appended environmental data<a class="anchor" aria-label="anchor" href="#examining-the-appended-environmental-data"></a>
</h3>
<p>Now let’s see how the detections of our tagged animals corresponded
with variations in sea water temperature. First let’s add the in-situ
temperature values to the detection plots grouped by
<code>transmitter_id</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summarised_data_id</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data_with_mooring_sst_shallow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">transmitter_id</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            mean_temperature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">moor_sea_temp</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">summarised_data_id</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">transmitter_id</span>, size <span class="op">=</span> <span class="va">num_det</span>, color <span class="op">=</span> <span class="va">mean_temperature</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"In-situ sea water temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot7.png"><br></p>
<p>Alternatively we can view the appended detection plots grouped by
<code>station_name</code> for only those installations which have
mooring sensor data associated with it:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summarised_data_id</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data_with_mooring_sst_shallow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">installation_name</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            mean_temperature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">moor_sea_temp</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;% drop_na(mean_temperature)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">summarised_data_id</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>,y<span class="op">=</span><span class="va">installation_name</span>,</span>
<span>                               size<span class="op">=</span><span class="va">num_det</span>,color<span class="op">=</span><span class="va">mean_temperature</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"In-situ sea water temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot8.png"><br></p>
<p>Finally, we can plot the sensor values associated to a detection as a
histogram showing the number of detection records associated with each
sensor value.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hrbrthemes</span><span class="op">)</span></span>
<span><span class="co"># First plot the temperature data</span></span>
<span><span class="va">data_with_mooring_sst_shallow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">moor_sea_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth<span class="op">=</span><span class="fl">1</span>,fill<span class="op">=</span><span class="st">"#69b3a2"</span>,color<span class="op">=</span><span class="st">"#e9ecef"</span>,alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">installation_name</span>,scales<span class="op">=</span><span class="st">"free_y"</span>,drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"In-situ sea water temperatures when bull sharks present (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#theme_ipsum() +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot9.png"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Next plot the depth data</span></span>
<span><span class="va">data_with_mooring_sst_shallow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="va">moor_sea_temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">moor_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth<span class="op">=</span><span class="fl">5</span>, fill<span class="op">=</span><span class="st">"#69b3a2"</span>, color<span class="op">=</span><span class="st">"#e9ecef"</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Depths of sea water temperature readings (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html" class="external-link">theme_ipsum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="images/moor_extract/moor_extract_plot10.png"></p>
<hr>
<p><strong>Vignette version</strong> 0.1.2 (05 Nov 2021)</p>
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;">

</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Fabrice Jaine, Ian Jonsen, Vinay Udyawer, Ross Dwyer, Kylie Scales, Francisca Maron, Xavier Hoenner, Charlie Huveneers, Yuri Niella.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
