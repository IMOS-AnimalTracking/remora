<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>extractEnv • remora</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="extractEnv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">remora</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="">0.8-04</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shinyReport_transmitters.html">shinyReport_transmitters</a>
    </li>
    <li>
      <a href="../articles/shinyReport_receivers.html">shinyReport_receivers</a>
    </li>
    <li>
      <a href="../articles/runQC.html">runQC</a>
    </li>
    <li>
      <a href="../articles/extractEnv.html">extractEnv</a>
    </li>
    <li>
      <a href="../articles/extractBlue.html">extractBlue</a>
    </li>
    <li>
      <a href="../articles/extractMoor.html">extractMoor</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/IMOS-AnimalTracking/remora" class="external-link">
    <span class="fa fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="extractEnv_files/kePrint-0.0.1/kePrint.js"></script><link href="extractEnv_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>extractEnv</h1>
            <h3 data-toc-skip class="subtitle">Integrating remotely
sensed environmental data with QC’d animal detections</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/IMOS-AnimalTracking/remora/blob/master/vignettes/extractEnv.Rmd" class="external-link"><code>vignettes/extractEnv.Rmd</code></a></small>
      <div class="hidden name"><code>extractEnv.Rmd</code></div>

    </div>

    
    
<pre><code><span><span class="co">## Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">##   object 'type_sum.accel' not found</span></span></code></pre>
<hr>
<p>Another key functionality of the <code>remora</code> package allows
users to integrate acoustic telemetry data and environmental and habitat
information. This package allows the user to match a range of
environmental variables to each detection. Associating environmental
data to detections provides a means to analyse environmental or habitat
drivers of occurrence, presence and movement of animal monitored using
acoustic telemetry. We advocate for users to first undertake a quality
control step using the <code><a href="../reference/runQC.html">runQC()</a></code> function and workflow before
further analysis (see <code><a href="../articles/runQC.html">vignette('runQC')</a></code>), however the
functionality to append environmental data will work on any dataset that
has at the minimum spatial coordinates and a timestamp for each
detection event.</p>
<p>Currently, the focus of this package is to integrate animal telemetry
data and environmental data collated by Australia’s <a href="https://imos.org.au" class="external-link">Integrated Marine Observing System</a>.
Therefore, the geographical scope of available datasets is currently
restricted to the Australiasia region. As this package develops, more
sources of environmental data will be added to enable users to access
more datasets across Australia and globally.</p>
<p><br></p>
<div class="section level2">
<h2 id="types-of-environmental-data">Types of environmental data<a class="anchor" aria-label="anchor" href="#types-of-environmental-data"></a>
</h2>
<p>This package allows users to access a range of ocean observing
datasets that have undergone a quality control process and housed within
the <a href="https://imos.org.au" class="external-link">Integrated Marine Observing
System</a>. These datasets can also be explored through the <a href="https://portal.aodn.org.au" class="external-link">Australian Ocean Data Network
portal</a>. There are primarily two types of environmental data that
users can currently access:</p>
<p><em>1. Remotely-sensed or gridded environmental data</em></p>
<p><em>2. In situ sub-surface environmental data from moorings at fixed
locations</em></p>
<p><br></p>
<p>The <code><a href="../reference/imos_variables.html">imos_variables()</a></code> function will help the user
identify currently available environmental layers that can be accessed
and associated. Variables include spatial layers including
<code>bathy</code> and <code>dist_to_land</code>, which provide distance
measures of bathymetry (in meters) and proximity to land (in
kilometers). Variable names that start with <code>rs_</code> are
remotely-sensed or gridded environmental layers, and variables starting
with <code>moor_</code> include <em>in situ</em> sub-surface mooring
environmental layers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/IMOS-AnimalTracking/remora/" class="external-link">remora</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/imos_variables.html">imos_variables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table  lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Platform
</th>
<th style="text-align:left;">
Temporal resolution
</th>
<th style="text-align:left;">
Units
</th>
<th style="text-align:left;">
Function to use
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Source
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
bathy
</td>
<td style="text-align:left;">
Composite raster product
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
meters
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Australian Bathymetry and Topography Grid. 250 m resolution.
</td>
<td style="text-align:left;">
Geosciences Australia
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
dist_to_land
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
kilometers
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Distance from nearest shoreline (in km). Derived from the
high-resolution Open Street Map shoreline product.
</td>
<td style="text-align:left;">
This package
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_sst
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
1-day multi-swath multi-sensor (L3S) remotely sensed sea surface
temperature (degrees Celcius) at 2 km resolution. Derived from the Group
for High Resolution Sea Surface Temperature (GHRSST)
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_sst_interpolated
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (2006-06-12 - present)
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
1-day interpolated remotely sensed sea surface temperature (degrees
Celcius) at 9 km resolution. Derived from the Regional Australian
Multi-Sensor Sea surface temperature Analysis (RAMSSA, Beggs et
al. 2010) system as part of the BLUElink Ocean Forecasting Australia
project
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_chl
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
mg.m-3
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Remotely sensed chlorophyll-a concentration (OC3 model). Derived from
the MODIS Aqua satellite mission. Multi-spectral measurements are used
to infer the concentration of chlorophyll-a, most typically due to
phytoplankton, present in the water (mg.m-3).
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_current
</td>
<td style="text-align:left;">
Composite raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1; degrees
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Gridded (adjusted) sea level anomaly (GSLA), surface geostrophic
velocity in the east-west (UCUR) and north-south (VCUR) directions for
the Australasian region derived from the IMOS Ocean Current project. Two
additional variables are calculated: surface current velocity (ms-1) and
bearing (degrees).
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_salinity
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
weekly (2011-08-25 - 2015-06-07)
</td>
<td style="text-align:left;">
psu
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
7-day composite remotely sensed salinity. Derived from the NASA Aquarius
satellite mission (psu).
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_turbidity
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
m-1
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Diffuse attenuation coefficient at 490 nm (K490) indicates the turbidity
of the water column (m-1). The value of K490 represents the rate which
light at 490 nm is attenuated with depth. For example a K490 of
0.1/meter means that light intensity will be reduced one natural log
within 10 meters of water. Thus, for a K490 of 0.1, one attenuation
length is 10 meters. Higher K490 value means smaller attenuation depth,
and lower clarity of ocean water.
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
rs_npp
</td>
<td style="text-align:left;">
Satellite-derived raster product
</td>
<td style="text-align:left;">
daily (2002-07-04 - present)
</td>
<td style="text-align:left;">
mgC.m_2.day-1
</td>
<td style="text-align:left;">
extractEnv()
</td>
<td style="text-align:left;width: 30em; ">
Net primary productivity (OC3 model and Eppley-VGPM algorithm). Modelled
product used to compute an estimate of the Net Primary Productivity
(NPP). The model used is based on the standard vertically generalised
production model (VGPM). The VGPM is a “chlorophyll-based” model that
estimates net primary production from chlorophyll using a
temperature-dependent description of chlorophyll-specific photosynthetic
efficiency. For the VGPM, net primary production is a function of
chlorophyll, available light, and the photosynthetic efficiency. The
only difference between the Standard VGPM and the Eppley-VGPM is the
temperature-dependent description of photosynthetic efficiencies, with
the Eppley approach using an exponential function to account for
variation in photosynthetic efficiencies due to photoacclimation.
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_sea_temp
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of sea
temperature (degrees Celcius) at fixed mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_psal
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
psu
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of salinity
(psu) at fixed mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_ucur
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
ms-1
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of subsurface
geostrophic current velocity in the east-west direction (ms-1) at fixed
mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
moor_vcur
</td>
<td style="text-align:left;">
Fixed sub-surface moorings
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
ms-1
</td>
<td style="text-align:left;">
extractMoor()
</td>
<td style="text-align:left;width: 30em; ">
Depth-integrated in-situ, hourly time-series measurements of subsurface
geostrophic current velocity in the north-south direction (ms-1) at
fixed mooring locations
</td>
<td style="text-align:left;">
IMOS
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_temp
</td>
<td style="text-align:left;">
3D Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
degrees Celcius
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Water temperature at specified depth from the surface to 4,509-m depth
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_salt
</td>
<td style="text-align:left;">
3D Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
psu
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Water salinity at specified depth from the surface to 4,509-m depth
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_cur
</td>
<td style="text-align:left;">
3D Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1; degrees clockwise
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Geostrophic velocity in the east-west (UCUR) and north-south (VCUR)
directions from the surface to 4,509-m depth. Two additional variables
are calculated: BRAN_spd = current velocity (ms-1) and BRAN_dir =
current bearing (degrees).
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_wcur
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Vertical current speed in the water column is calculated (negative =
downwards; positive = upwards) using the layers available between the
surface to 200-m depths.
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_ssh
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
meters
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Sea surface height at the water surface
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_mld
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
meters
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Mixed layer depth in relation to the water surface
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BRAN_wind
</td>
<td style="text-align:left;">
Raster product
</td>
<td style="text-align:left;">
daily (1993-01-01 - present)
</td>
<td style="text-align:left;">
ms-1; degrees clockwise
</td>
<td style="text-align:left;">
extractBlue()
</td>
<td style="text-align:left;width: 30em; ">
Two variables are calculated, including BRAN_wind_spd = wind velocity
(ms-1) and BRAN_wind_dir = wind bearing (degrees).
</td>
<td style="text-align:left;">
Bluelink (CSIRO)
</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>In this vignette we will explore accessing and integrating gridded
data. A suite of additional functions can be used to access and extract
<em>in situ</em> sub-surface data from moorings (see
<code><a href="../articles/extractMoor.html">vignette('extractMoor')</a></code>).</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="usage-of-the-extractenv-function">Usage of the <code>extractEnv()</code> function<a class="anchor" aria-label="anchor" href="#usage-of-the-extractenv-function"></a>
</h2>
<div class="section level3">
<h3 id="load-example-dataset">Load example dataset<a class="anchor" aria-label="anchor" href="#load-example-dataset"></a>
</h3>
<p>The primary function to extract and append remote sensing data to
acoustic detection data is the <code><a href="../reference/extractEnv.html">extractEnv()</a></code> function. Lets
start with a dataset that has undergone quality control (see
<code><a href="../articles/runQC.html">vignette('runQC')</a></code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/" class="external-link">ggspatial</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Example dataset that has undergone quality control using the `runQC()` function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TownsvilleReefQC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Only retain detections flagged as 'valid' and 'likely valid' (Detection_QC 1 and 2)</span></span>
<span><span class="va">qc_data</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">TownsvilleReefQC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">QC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Detection_QC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>Lets have a quick look at the spatial patterns in detection data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">transmitter_id</span>, <span class="va">station_name</span>, <span class="va">installation_name</span>, <span class="va">receiver_deployment_longitude</span>, <span class="va">receiver_deployment_latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_map_tile</span><span class="op">(</span><span class="st">'cartolight'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatial_point</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receiver_deployment_longitude</span>, y <span class="op">=</span> <span class="va">receiver_deployment_latitude</span>, </span>
<span>                         size <span class="op">=</span> <span class="va">num_det</span>, color <span class="op">=</span> <span class="va">installation_name</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">transmitter_id</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span>, color <span class="op">=</span> <span class="st">"Installation Name"</span> , size <span class="op">=</span> <span class="st">"Number of\nDetections"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot1.png"></p>
<p><br></p>
<p>We can also have a look at the temporal pattern in detections:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">transmitter_id</span>, <span class="va">date</span>, <span class="va">installation_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">transmitter_id</span>, color <span class="op">=</span> <span class="va">installation_name</span>, size <span class="op">=</span> <span class="va">num_det</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="st">"Installation Name"</span>, size <span class="op">=</span> <span class="st">"Number of\nDetections"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot2.png"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="environmental-data-extraction">Environmental data extraction<a class="anchor" aria-label="anchor" href="#environmental-data-extraction"></a>
</h3>
<p>In this example, we will extract two variables; <em>Interpolated sea
surface temperature</em> and <em>modeled ocean surface
currents</em>.</p>
<p>Each variable will need to be accessed one at a time using the
<code><a href="../reference/extractEnv.html">extractEnv()</a></code> function. There are a few parameters within
the function that can help the user identify the variable required, and
to manage the downloaded environmental layers:</p>
<ul>
<li>
<strong>df</strong>: the data frame with the detection data</li>
<li>
<strong>X</strong>: the name of the column with longitude for each
detection</li>
<li>
<strong>Y</strong>: the name of the column with latitude for each
detection</li>
<li>
<strong>datetime</strong>: the name of the column with the
date-timestamp for each detection</li>
<li>
<strong>env_var</strong>: the name of the environmental variable to
download and append (see <code><a href="../reference/imos_variables.html">imos_variables()</a></code> for available
variables and variable names)</li>
<li>
<strong>cache_layers</strong>: should the extracted environmental
data layers be cached within the working directory? If so, spatial
layers will be cached within a folder called <code>imos.cache</code>
within your working directory.</li>
<li>
<strong>crop_layers</strong>: should the extracted environmental
data be cropped to within the study site? reduces the file size of
downloaded files</li>
<li>
<strong>full_timeperiod</strong>: should environmental variables
extracted for each day across full monitoring period, if set to
<code>TRUE</code> it can be time and memory consuming for long
projects</li>
<li>
<strong>folder_name</strong>: name of folder within
<code>imos.cache</code> where downloaded rasters should be saved. If
none provided automatic folder names generated based on study
extent</li>
<li>
<strong>.parallel</strong>: should the function be run in parallel?
speeds up environmental extraction for large datasets</li>
</ul>
<p><br></p>
<div class="section level5">
<h5 id="gap-filling-functionality">
<em>Gap filling functionality</em><a class="anchor" aria-label="anchor" href="#gap-filling-functionality"></a>
</h5>
<p>Remote sensed environmental data within coastal areas (where acoustic
arrays are often deployed) are often unreliable due to shallow habitats
and close proximity to turbid nearshore waters. The quality control
process for Ocean colour variables within the IMOS dataset often remove
pixels in close proximity to coastlines due to the low quality of
environmental variables in these regions. Here is an example where
coastal remote sensing data may not match up with positions of deployed
acoustic arrays.</p>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot7.png"></p>
<p>In these cases, a simple extraction will result in <code>NA</code>s
where no overlap occurs (e.g., black points in the figure above). To
maximise the understanding of environmental variables in the region of
coastal arrays, <code><a href="../reference/extractEnv.html">extractEnv()</a></code> provides the functionality to
fill gaps in the extraction data using the <code>fill_gaps</code>
parameter. If <code>fill_gaps = TRUE</code>, the function will extract
the median variable values within a buffer around points that do not
overlap data pixels (broken buffers around black points in the figure
above). The radius of the buffer around the points that do not overlap
data can be user defined (in meters) using the additional
<code>buffer</code> parameter. If no <code>buffer</code> value is
provided by the user, the function will automatically choose a buffer
radius based on the resolution of environmental layer [5 km for
<code>rs_sst</code>, <code>rs_chl</code>, <code>rs_npp</code>,
<code>rs_turbidity</code>; 15 km for <code>rs_sst_interpolated</code>;
20 km for <code>rs_current</code> and <code>rs_salinity</code>].</p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="interpolated-sea-surface-temperature">
<em>Interpolated sea surface temperature</em><a class="anchor" aria-label="anchor" href="#interpolated-sea-surface-temperature"></a>
</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_sst</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/extractEnv.html">extractEnv</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">qc_data</span>,</span>
<span>             X <span class="op">=</span> <span class="st">"receiver_deployment_longitude"</span>, </span>
<span>             Y <span class="op">=</span> <span class="st">"receiver_deployment_latitude"</span>, </span>
<span>             datetime <span class="op">=</span> <span class="st">"detection_datetime"</span>, </span>
<span>             env_var <span class="op">=</span> <span class="st">"rs_sst_interpolated"</span>,  <span class="co">## Currently only a single variable can be called at a time</span></span>
<span>             cache_layers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             crop_layers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             fill_gaps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             full_timeperiod <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             folder_name <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>             .parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level5">
<h5 id="modeled-ocean-surface-currents">
<em>Modeled ocean surface currents</em><a class="anchor" aria-label="anchor" href="#modeled-ocean-surface-currents"></a>
</h5>
<p>We can now also append current data to this dataset:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_sst_and_current</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">data_with_sst</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extractEnv.html">extractEnv</a></span><span class="op">(</span>X <span class="op">=</span> <span class="st">"receiver_deployment_longitude"</span>, </span>
<span>             Y <span class="op">=</span> <span class="st">"receiver_deployment_latitude"</span>, </span>
<span>             datetime <span class="op">=</span> <span class="st">"detection_datetime"</span>, </span>
<span>             env_var <span class="op">=</span> <span class="st">"rs_current"</span>, </span>
<span>             cache_layers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             crop_layers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             fill_gaps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             full_timeperiod <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             folder_name <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>             .parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>As we set <code>cache_layers</code> to <code>TRUE</code>, the
downloaded layers will be cached within the <code>imos.cache</code>
folder within the working directory. Each time the function is called,
downloaded layers are cached into this folder. We have also set the
function to save the raster layers as the default .grd format within a
subfolder called <code>test</code>.</p>
<p>When downloading current data, three variables are downloaded:
Gridded Sea Level Anomaly (<code>rs_gsla</code>), surface geostrophic
velocity in the north-south direction (<code>rs_vcur</code>) and the
east-west direction (<code>rs_ucur</code>). These variables are used to
calculate current velocity and bearing and appended to detections</p>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="examining-the-appended-environmental-data">Examining the appended environmental data<a class="anchor" aria-label="anchor" href="#examining-the-appended-environmental-data"></a>
</h3>
<p>We can now see the extracted environmental variables are appended as
new columns to the input dataset</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_sst_and_current</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 597 × 61</span></span></span>
<span><span class="co">##    filename    transmitter_id tag_id transmitter_deployme…¹ tagging_project_name</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> A69-9002-1… A69-9002-13807 6.99<span style="color: #949494;">e</span>7               69<span style="text-decoration: underline;">918</span>684 Townsville Reefs    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 587 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated name: ¹​transmitter_deployment_id</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more variables: species_common_name &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   species_scientific_name &lt;chr&gt;, CAAB_species_id &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   WORMS_species_aphia_id &lt;int&gt;, animal_sex &lt;chr&gt;, detection_datetime &lt;dttm&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   receiver_deployment_longitude &lt;dbl&gt;, receiver_deployment_latitude &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   receiver_project_name &lt;chr&gt;, installation_name &lt;chr&gt;, station_name &lt;chr&gt;, …</span></span></span></code></pre>
<p>We can also now add the variables to the detection plots:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summarised_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data_with_sst_and_current</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">detection_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">transmitter_id</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>num_det <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            mean_sst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rs_sst_interpolated</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            mean_current_velocity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rs_current_velocity</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            mean_current_bearing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rs_current_bearing</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">summarised_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">transmitter_id</span>, size <span class="op">=</span> <span class="va">num_det</span>, color <span class="op">=</span> <span class="va">mean_sst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Interpolated sea surface temperature"</span>, x <span class="op">=</span> <span class="st">"Date"</span>, </span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="st">"SST (˚C)"</span>, size <span class="op">=</span> <span class="st">"Number of\nDetections"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot3.png"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">summarised_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">transmitter_id</span>, color <span class="op">=</span> <span class="va">mean_current_velocity</span>,</span>
<span>                 size <span class="op">=</span> <span class="va">num_det</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_spoke.html" class="external-link">geom_spoke</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">transmitter_id</span>, angle <span class="op">=</span> <span class="va">mean_current_bearing</span>, radius <span class="op">=</span> <span class="va">mean_current_velocity</span><span class="op">)</span>,</span>
<span>             arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="st">'inches'</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey"</span>, lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Direction and velocity of modeled surface currents"</span>, x <span class="op">=</span> <span class="st">"Date"</span>, </span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="st">"Current\nVelocity (ms-1)"</span>, size <span class="op">=</span> <span class="st">"Number of\nDetections"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot4.png"></p>
<p><br><br></p>
<p>If the environmental layers were cached, we can also look at how the
variables altered spatially:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Detection data summary</span></span>
<span><span class="va">det_summary</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">qc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">station_name</span>, lon <span class="op">=</span> <span class="va">receiver_deployment_longitude</span>, lat <span class="op">=</span> <span class="va">receiver_deployment_latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Sea surface temperature</span></span>
<span><span class="va">sst_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="st">"imos.cache/rs variables/test/rs_sst_interpolated.grd"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sst_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sst_raster</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span><span class="op">]</span>, xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sst_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">det_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"red"</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Interpolated\nSST (˚C)"</span>, x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot5.png"></p>
<p><br></p>
<p>Current data can be plotted using other very useful libraries like
the <a href="https://github.com/eliocamp/metR" class="external-link"><code>metR</code></a>
package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Current</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/metR/" class="external-link">metR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## read in vcur and ucur spatial data</span></span>
<span><span class="va">vcur_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="st">"imos.cache/rs variables/test/rs_vcur.grd"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">vcur_raster</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">vcur_raster</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ucur_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="st">"imos.cache/rs variables/test/rs_ucur.grd"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ucur_raster</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">ucur_raster</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">## calculate velocity (ms-1)</span></span>
<span><span class="va">vel_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">vcur_raster</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">ucur_raster</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## extract values from raster stacks</span></span>
<span><span class="va">uv</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">vcur_raster</span>, xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"date"</span>, values_to <span class="op">=</span> <span class="st">"v"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ucur_raster</span>, xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"date"</span>, values_to <span class="op">=</span> <span class="st">"u"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">vel_raster</span>, xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"date"</span>, values_to <span class="op">=</span> <span class="st">"vel"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">date</span>, start <span class="op">=</span> <span class="fl">2</span>, end <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"[.]"</span>, replacement <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_contour_fill</span><span class="op">(</span>data <span class="op">=</span> <span class="va">uv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, z <span class="op">=</span> <span class="va">vel</span>, fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    binwidth <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_streamline</span><span class="op">(</span>data <span class="op">=</span> <span class="va">uv</span>, skip <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">0.05</span>, L <span class="op">=</span> <span class="fl">1</span>, res <span class="op">=</span> <span class="fl">5</span>, jitter <span class="op">=</span> <span class="fl">5</span>, lineend <span class="op">=</span> <span class="st">"round"</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, dx <span class="op">=</span> <span class="va">u</span>, dy <span class="op">=</span> <span class="va">v</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, name <span class="op">=</span> <span class="st">"Current Velocity (m/s)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">det_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"red"</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">date</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Modeled surface currents"</span>, x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fenv_extract%2Fenv_extract_plot6.png"></p>
<p><br></p>
<hr>
<p><strong>Vignette version</strong> 0.0.3 (10 Oct 2021)</p>
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;">

</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Fabrice Jaine, Ian Jonsen, Vinay Udyawer, Ross Dwyer, Kylie Scales, Francisca Maron, Xavier Hoenner, Charlie Huveneers, Yuri Niella.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
